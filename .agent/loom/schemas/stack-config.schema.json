{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claude-loom.dev/schemas/stack-config.schema.json",
  "title": "Loom Stack Configuration",
  "description": "Project-specific configuration defining the tech stack, conventions, and actor customization. This file enables actors to understand the project context and follow established patterns.",
  "type": "object",
  "required": ["project", "runtime"],
  "properties": {
    "project": {
      "type": "string",
      "description": "Project name/identifier",
      "minLength": 1,
      "examples": ["my-saas-app", "enterprise-dashboard"]
    },
    "version": {
      "type": "string",
      "description": "Stack config schema version",
      "const": "2.0"
    },
    "runtime": {
      "type": "string",
      "description": "JavaScript/TypeScript runtime",
      "enum": ["bun", "node", "deno"]
    },
    "packageManager": {
      "type": "string",
      "description": "Package manager in use",
      "enum": ["bun", "npm", "yarn", "pnpm"],
      "default": "npm"
    },
    "monorepo": {
      "type": "object",
      "description": "Monorepo configuration if applicable",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "tool": {
          "type": "string",
          "enum": ["turborepo", "nx", "lerna", "rush", "none"]
        },
        "packages": {
          "type": "array",
          "description": "Package/workspace directories",
          "items": {
            "type": "string"
          },
          "examples": [["apps/*", "packages/*"]]
        }
      }
    },
    "backend": {
      "$ref": "#/definitions/BackendConfig",
      "description": "Backend technology stack"
    },
    "frontend": {
      "$ref": "#/definitions/FrontendConfig",
      "description": "Frontend technology stack"
    },
    "testing": {
      "$ref": "#/definitions/TestingConfig",
      "description": "Testing framework configuration"
    },
    "infrastructure": {
      "$ref": "#/definitions/InfrastructureConfig",
      "description": "Infrastructure and deployment configuration"
    },
    "conventions": {
      "$ref": "#/definitions/Conventions",
      "description": "Project coding conventions and standards"
    },
    "actors": {
      "type": "object",
      "description": "Per-actor customization settings",
      "additionalProperties": {
        "$ref": "#/definitions/ActorConfig"
      },
      "propertyNames": {
        "enum": ["architect", "backend-dev", "frontend-dev", "qa-engineer", "devops", "tech-writer"]
      }
    },
    "paths": {
      "type": "object",
      "description": "Important project paths",
      "properties": {
        "source": {
          "type": "string",
          "description": "Main source directory",
          "default": "src"
        },
        "tests": {
          "type": "string",
          "description": "Test files directory",
          "default": "tests"
        },
        "docs": {
          "type": "string",
          "description": "Documentation directory",
          "default": "docs"
        },
        "config": {
          "type": "string",
          "description": "Configuration files directory"
        }
      }
    },
    "commands": {
      "type": "object",
      "description": "Common project commands",
      "properties": {
        "dev": {
          "type": "string",
          "description": "Start development server"
        },
        "build": {
          "type": "string",
          "description": "Build for production"
        },
        "test": {
          "type": "string",
          "description": "Run tests"
        },
        "lint": {
          "type": "string",
          "description": "Run linter"
        },
        "typecheck": {
          "type": "string",
          "description": "Run type checking"
        },
        "migrate": {
          "type": "string",
          "description": "Run database migrations"
        }
      }
    }
  },
  "definitions": {
    "BackendConfig": {
      "type": "object",
      "description": "Backend stack configuration",
      "properties": {
        "framework": {
          "type": "string",
          "description": "Backend framework",
          "enum": ["elysia", "express", "fastify", "hono", "koa", "nestjs", "none"],
          "examples": ["elysia", "express"]
        },
        "language": {
          "type": "string",
          "description": "Backend language",
          "enum": ["typescript", "javascript"],
          "default": "typescript"
        },
        "database": {
          "type": "string",
          "description": "Primary database",
          "enum": ["postgresql", "mysql", "mongodb", "sqlite", "redis", "none"],
          "examples": ["postgresql"]
        },
        "orm": {
          "type": "string",
          "description": "ORM/Query builder",
          "enum": ["drizzle", "prisma", "typeorm", "sequelize", "mongoose", "knex", "none"],
          "examples": ["drizzle", "prisma"]
        },
        "queue": {
          "type": "string",
          "description": "Job/message queue",
          "enum": ["pg-boss", "bullmq", "rabbitmq", "sqs", "none"]
        },
        "cache": {
          "type": "string",
          "description": "Caching solution",
          "enum": ["redis", "memcached", "none"]
        },
        "auth": {
          "type": "string",
          "description": "Authentication approach",
          "enum": ["session", "jwt", "oauth", "clerk", "auth0", "supabase", "custom"]
        },
        "api": {
          "type": "string",
          "description": "API style",
          "enum": ["rest", "graphql", "trpc", "grpc"]
        },
        "validation": {
          "type": "string",
          "description": "Request validation library",
          "enum": ["zod", "typebox", "yup", "joi", "class-validator"]
        }
      }
    },
    "FrontendConfig": {
      "type": "object",
      "description": "Frontend stack configuration",
      "properties": {
        "framework": {
          "type": "string",
          "description": "Frontend framework",
          "enum": ["react", "vue", "svelte", "solid", "angular", "nextjs", "nuxt", "remix", "astro", "none"]
        },
        "language": {
          "type": "string",
          "description": "Frontend language",
          "enum": ["typescript", "javascript"],
          "default": "typescript"
        },
        "router": {
          "type": "string",
          "description": "Routing solution",
          "enum": ["react-router-v7", "react-router-v6", "tanstack-router", "next-router", "vue-router", "none"]
        },
        "state": {
          "type": "string",
          "description": "State management",
          "enum": ["tanstack-query", "zustand", "jotai", "redux", "pinia", "none"]
        },
        "ui": {
          "type": "string",
          "description": "UI component library",
          "enum": ["shadcn", "radix", "chakra", "mantine", "mui", "tailwind-only", "none"]
        },
        "styling": {
          "type": "string",
          "description": "CSS approach",
          "enum": ["tailwind", "css-modules", "styled-components", "emotion", "vanilla-css"]
        },
        "forms": {
          "type": "string",
          "description": "Form handling library",
          "enum": ["react-hook-form", "formik", "tanstack-form", "none"]
        },
        "bundler": {
          "type": "string",
          "description": "Build tool/bundler",
          "enum": ["vite", "webpack", "esbuild", "turbopack", "parcel"]
        }
      }
    },
    "TestingConfig": {
      "type": "object",
      "description": "Testing configuration",
      "properties": {
        "unit": {
          "type": "string",
          "description": "Unit test framework",
          "enum": ["bun:test", "vitest", "jest", "mocha", "none"]
        },
        "e2e": {
          "type": "string",
          "description": "End-to-end test framework",
          "enum": ["playwright", "cypress", "none"]
        },
        "integration": {
          "type": "string",
          "description": "Integration test approach",
          "enum": ["supertest", "pactum", "httpyac", "none"]
        },
        "coverage": {
          "type": "object",
          "description": "Code coverage settings",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "threshold": { "type": "number", "minimum": 0, "maximum": 100 },
            "tool": { "type": "string", "enum": ["v8", "istanbul", "c8"] }
          }
        },
        "mocking": {
          "type": "string",
          "description": "Mocking approach",
          "enum": ["none", "msw", "nock", "sinon"]
        }
      }
    },
    "InfrastructureConfig": {
      "type": "object",
      "description": "Infrastructure and deployment",
      "properties": {
        "hosting": {
          "type": "string",
          "description": "Hosting platform",
          "enum": ["vercel", "railway", "fly", "aws", "gcp", "azure", "self-hosted", "none"]
        },
        "ci": {
          "type": "string",
          "description": "CI/CD platform",
          "enum": ["github-actions", "gitlab-ci", "circleci", "jenkins", "none"]
        },
        "containerization": {
          "type": "string",
          "description": "Container technology",
          "enum": ["docker", "podman", "none"]
        },
        "orchestration": {
          "type": "string",
          "description": "Container orchestration",
          "enum": ["kubernetes", "docker-compose", "ecs", "none"]
        }
      }
    },
    "Conventions": {
      "type": "object",
      "description": "Project coding conventions",
      "properties": {
        "loopStyle": {
          "type": "string",
          "description": "Preferred loop style",
          "enum": ["for", "forEach", "for-of", "any"],
          "default": "for"
        },
        "asyncStyle": {
          "type": "string",
          "description": "Async handling preference",
          "enum": ["async-await", "promises", "any"],
          "default": "async-await"
        },
        "exportStyle": {
          "type": "string",
          "description": "Module export style",
          "enum": ["named", "default", "mixed"],
          "default": "named"
        },
        "functionStyle": {
          "type": "string",
          "description": "Function declaration style",
          "enum": ["arrow", "declaration", "mixed"],
          "default": "arrow"
        },
        "databasePort": {
          "type": "integer",
          "description": "Local database port",
          "minimum": 1024,
          "maximum": 65535,
          "examples": [5432, 5439, 3306]
        },
        "noMocking": {
          "type": "boolean",
          "description": "Avoid mocks in tests (prefer real implementations)",
          "default": false
        },
        "strictNullChecks": {
          "type": "boolean",
          "description": "TypeScript strict null checks enabled",
          "default": true
        },
        "preferConst": {
          "type": "boolean",
          "description": "Prefer const over let",
          "default": true
        },
        "semicolons": {
          "type": "boolean",
          "description": "Use semicolons",
          "default": true
        },
        "singleQuotes": {
          "type": "boolean",
          "description": "Use single quotes for strings",
          "default": true
        },
        "maxLineLength": {
          "type": "integer",
          "description": "Maximum line length",
          "minimum": 80,
          "maximum": 200,
          "default": 100
        },
        "indentation": {
          "type": "string",
          "description": "Indentation style",
          "enum": ["spaces-2", "spaces-4", "tabs"],
          "default": "spaces-2"
        },
        "namingConventions": {
          "type": "object",
          "description": "Naming convention rules",
          "properties": {
            "files": { "type": "string", "enum": ["kebab-case", "camelCase", "PascalCase"] },
            "components": { "type": "string", "enum": ["PascalCase", "kebab-case"] },
            "functions": { "type": "string", "enum": ["camelCase", "snake_case"] },
            "constants": { "type": "string", "enum": ["UPPER_SNAKE_CASE", "camelCase"] }
          }
        }
      }
    },
    "ActorConfig": {
      "type": "object",
      "description": "Configuration for a specific actor type",
      "properties": {
        "model": {
          "type": "string",
          "description": "Claude model to use for this actor",
          "enum": ["opus", "sonnet", "haiku"],
          "default": "sonnet"
        },
        "color": {
          "type": "string",
          "description": "Display color for this actor in UI/logs",
          "enum": ["purple", "blue", "green", "yellow", "red", "orange", "cyan", "magenta"]
        },
        "customPromptPath": {
          "type": "string",
          "description": "Path to custom prompt template for this actor"
        },
        "maxAttempts": {
          "type": "integer",
          "description": "Override default circuit breaker limit",
          "minimum": 1,
          "maximum": 5,
          "default": 3
        },
        "timeout": {
          "type": "integer",
          "description": "Task timeout in minutes",
          "minimum": 1,
          "maximum": 60,
          "default": 15
        },
        "specializations": {
          "type": "array",
          "description": "Specific areas this actor specializes in",
          "items": {
            "type": "string"
          },
          "examples": [["authentication", "security"], ["real-time", "websockets"]]
        }
      }
    }
  },
  "examples": [
    {
      "project": "my-saas-app",
      "version": "2.0",
      "runtime": "bun",
      "packageManager": "bun",
      "monorepo": {
        "enabled": true,
        "tool": "turborepo",
        "packages": ["apps/*", "packages/*"]
      },
      "backend": {
        "framework": "elysia",
        "language": "typescript",
        "database": "postgresql",
        "orm": "drizzle",
        "queue": "pg-boss",
        "auth": "session",
        "api": "rest",
        "validation": "typebox"
      },
      "frontend": {
        "framework": "react",
        "language": "typescript",
        "router": "react-router-v7",
        "state": "tanstack-query",
        "ui": "shadcn",
        "styling": "tailwind",
        "forms": "react-hook-form",
        "bundler": "vite"
      },
      "testing": {
        "unit": "bun:test",
        "e2e": "playwright",
        "integration": "supertest",
        "mocking": "none"
      },
      "infrastructure": {
        "hosting": "railway",
        "ci": "github-actions",
        "containerization": "docker"
      },
      "conventions": {
        "loopStyle": "for",
        "asyncStyle": "async-await",
        "databasePort": 5439,
        "noMocking": true,
        "strictNullChecks": true,
        "preferConst": true,
        "semicolons": true,
        "singleQuotes": true,
        "indentation": "spaces-2",
        "namingConventions": {
          "files": "kebab-case",
          "components": "PascalCase",
          "functions": "camelCase",
          "constants": "UPPER_SNAKE_CASE"
        }
      },
      "actors": {
        "architect": { "model": "opus", "color": "purple" },
        "backend-dev": { "model": "sonnet", "color": "blue" },
        "frontend-dev": { "model": "sonnet", "color": "green" },
        "qa-engineer": { "model": "sonnet", "color": "yellow" },
        "devops": { "model": "sonnet", "color": "orange" },
        "tech-writer": { "model": "haiku", "color": "cyan" }
      },
      "paths": {
        "source": "src",
        "tests": "tests",
        "docs": "docs"
      },
      "commands": {
        "dev": "bun run dev",
        "build": "bun run build",
        "test": "bun test",
        "lint": "bun run lint",
        "typecheck": "bun run typecheck",
        "migrate": "bun run db:migrate"
      }
    }
  ]
}
