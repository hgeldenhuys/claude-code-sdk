{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claude-loom.dev/schemas/backlog.schema.json",
  "title": "Loom Backlog",
  "description": "Lightweight index for tracking all stories in the Domain Memory. This is the master list that Stage Manager reads to understand overall project state.",
  "type": "object",
  "required": ["version", "stories"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for forward compatibility",
      "const": "2.0"
    },
    "currentStory": {
      "type": ["string", "null"],
      "description": "ID of the currently active story, or null if no story is in progress",
      "pattern": "^[A-Z]+-[0-9]{3}$",
      "examples": ["US-015", "FEAT-001"]
    },
    "stories": {
      "type": "array",
      "description": "Array of all stories in the backlog, ordered by priority (highest first)",
      "items": {
        "$ref": "#/definitions/BacklogStory"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata about the backlog",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp when backlog was created"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp of last modification"
        },
        "totalCompleted": {
          "type": "integer",
          "minimum": 0,
          "description": "Running count of completed stories"
        }
      }
    }
  },
  "definitions": {
    "BacklogStory": {
      "type": "object",
      "description": "Lightweight reference to a story - full details in story.json",
      "required": ["id", "title", "status", "path"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique story identifier in format {FEATURE_CODE}-{nnn}",
          "pattern": "^[A-Z]+-[0-9]{3}$",
          "examples": ["US-014", "FEAT-002", "AUTH-001"]
        },
        "title": {
          "type": "string",
          "description": "Human-readable story title",
          "minLength": 5,
          "maxLength": 100,
          "examples": ["Batch/WorkItem Semantic Separation", "Real-time Dashboard"]
        },
        "status": {
          "type": "string",
          "description": "Current story status",
          "enum": ["planned", "in-progress", "completed", "blocked"],
          "enumDescriptions": {
            "planned": "Story is defined but not yet started",
            "in-progress": "Story is actively being worked on",
            "completed": "All acceptance criteria verified, story done",
            "blocked": "Story cannot proceed due to external dependency or issue"
          }
        },
        "path": {
          "type": "string",
          "description": "Relative path to story directory from .agent/loom/",
          "pattern": "^stories/[A-Z]+-[0-9]{3}/$",
          "examples": ["stories/US-014/", "stories/FEAT-002/"]
        },
        "priority": {
          "type": "string",
          "description": "Optional priority level",
          "enum": ["P0", "P1", "P2", "P3"],
          "default": "P1"
        },
        "blockedReason": {
          "type": "string",
          "description": "Reason for blocked status (required when status is 'blocked')",
          "minLength": 10
        }
      },
      "if": {
        "properties": { "status": { "const": "blocked" } }
      },
      "then": {
        "required": ["blockedReason"]
      }
    }
  },
  "examples": [
    {
      "version": "2.0",
      "currentStory": "US-015",
      "stories": [
        {
          "id": "US-014",
          "title": "Batch/WorkItem Separation",
          "status": "completed",
          "path": "stories/US-014/"
        },
        {
          "id": "US-015",
          "title": "Real-time Dashboard",
          "status": "in-progress",
          "path": "stories/US-015/",
          "priority": "P0"
        },
        {
          "id": "US-016",
          "title": "User Notifications",
          "status": "planned",
          "path": "stories/US-016/",
          "priority": "P1"
        }
      ],
      "metadata": {
        "createdAt": "2025-12-01T10:00:00Z",
        "lastUpdated": "2025-12-09T14:30:00Z",
        "totalCompleted": 14
      }
    }
  ]
}
